# 파일 카운트 분류 개선 (2025-11-06)

## 개요

분석 대상 파일과 미대상 파일을 명확히 구분하기 위해 Project 노드의 파일 통계 속성을 개선했습니다.

## 변경 배경

### 기존 문제점
```
total_etc_file_count (655개)
├─ 분석 대상: .yml, .yaml, .properties, .sql  ← 실제 분석됨
└─ 분석 미대상: .omm, .png, .md, .txt 등      ← 단순 카운트만
```

**문제:** 655개 중 몇 개가 실제로 분석되었는지 알 수 없음!

## 개선 사항

### 1. 새로운 파일 분류 체계 (옵션 3: 하이브리드)

```
Project 노드 속성:
├─ total_java_file_count (분석됨) - .java
├─ total_xml_file_count (분석됨) - .xml, .dbio
├─ total_config_file_count (분석됨) - .yml, .yaml, .properties
├─ total_ddl_file_count (분석됨) - .sql
├─ total_other_analyzed_file_count (향후 확장용)
├─ total_ignored_file_count (분석 안 됨) - .omm, .png, .md 등
├─ total_etc_file_count (deprecated, 하위 호환용)
└─ total_file_count (전체 파일)
```

### 2. 변경된 파일

1. **`csa/models/graph_entities.py`** - Project 모델에 새 속성 추가
2. **`csa/utils/project_statistics.py`** - 파일 집계 로직 수정
   - `calculate_project_statistics()` 함수
   - `calculate_project_statistics_from_neo4j()` 함수
   - `aggregate_file_statistics()` 함수
3. **`csa/services/graph_db/project_nodes.py`** - Neo4j 저장 로직 수정
   - `_create_project_node_tx()` 메서드에 새 파라미터 추가
4. **`csa/services/analysis/neo4j_writer.py`** - 로그 출력 개선
   - 프로젝트 통계 로그를 새로운 파일 분류 체계로 표시

### 3. 예시

#### 변경 전:
```
total_file_count: 1406
total_java_file_count: 739
total_xml_file_count: 12
total_etc_file_count: 655  ← 무엇이 분석되었는지 불명확
```

#### 변경 후:
```
total_file_count: 1406
total_java_file_count: 739 (분석됨)
total_xml_file_count: 12 (분석됨, .xml + .dbio)
total_config_file_count: 50 (분석됨, .yml + .yaml + .properties)
total_ddl_file_count: 30 (분석됨, .sql)
total_other_analyzed_file_count: 0 (향후 확장용)
total_ignored_file_count: 575 (분석 안 됨, .omm + .png + .md 등)
total_etc_file_count: 655 (deprecated, 하위 호환용)
```

**분석 대상:** 739 + 12 + 50 + 30 = 831개
**분석 미대상:** 575개
**전체:** 1406개 ✓

### 4. 로그 출력 개선

#### 변경 전:
```
프로젝트 통계: 전체 파일 1406개 (Java: 739, XML: 12, 기타: 655), PLOC: 467787, LLOC: 336457, CLOC: 83491
```

#### 변경 후:
```
================================================================================
프로젝트 통계: 전체 파일 1406개
  - 분석 대상: 831개 (Java: 739, XML: 12, Config: 50, DDL: 30)
  - 분석 미대상: 575개
  - LOC 통계: PLOC 467787, LLOC 336457, CLOC 83491
================================================================================
```

**개선 사항:**
- 분석 대상과 미대상을 명확히 구분
- 각 파일 타입별로 상세한 통계 표시
- 가독성 향상 (여러 줄 + 구분선)

## 하위 호환성

- `total_etc_file_count`는 deprecated로 표시하되 계속 유지
- 기존 쿼리나 리포트가 깨지지 않도록 보장
- `total_etc_file_count = total_config_file_count + total_ddl_file_count + total_other_analyzed_file_count + total_ignored_file_count`

## 테스트

### 단위 테스트
- 파일 분류 테스트: `tests/unit/test_file_classification.py`
  1. `test_file_classification()` - 각 파일 타입별 분류 검증
  2. `test_analyzed_vs_ignored_classification()` - 분석/미분석 구분 검증

- 로그 출력 테스트: `tests/unit/test_project_statistics_logging.py`
  1. `test_project_statistics_log_format()` - 로그 포맷 검증
  2. `test_analyzed_files_calculation()` - 분석 대상 파일 수 계산 검증

### 실행 방법
```bash
# 파일 분류 테스트
pytest tests/unit/test_file_classification.py -v

# 로그 출력 테스트
pytest tests/unit/test_project_statistics_logging.py -v
```

### 테스트 결과
```
# 파일 분류 테스트
tests/unit/test_file_classification.py::test_file_classification PASSED
tests/unit/test_file_classification.py::test_analyzed_vs_ignored_classification PASSED
2 passed in 0.21s

# 로그 출력 테스트
tests/unit/test_project_statistics_logging.py::test_project_statistics_log_format PASSED
tests/unit/test_project_statistics_logging.py::test_analyzed_files_calculation PASSED
2 passed in 0.18s
```

## 향후 확장 가능성

새로운 파일 타입을 추가할 때:
1. 분석 대상이면 → 새로운 속성 추가 (예: `total_proto_file_count`)
2. 분석 미대상이면 → `total_ignored_file_count`에 자동 포함

## 영향도 분석

### 영향받는 컴포넌트
- ✅ Project 노드 생성/업데이트 로직 (자동 처리됨)
- ✅ Neo4j 저장 로직 (Pydantic 모델 사용으로 자동 처리됨)
- ⚠️ 리포트 생성 로직 (새 속성 활용 가능)
- ⚠️ 대시보드/통계 화면 (새 속성 표시 가능)

### 기존 코드 호환성
- `total_etc_file_count`를 사용하는 기존 코드는 정상 작동
- 새로운 속성을 활용하려면 코드 업데이트 필요

## 참고

- 이슈: 분석 대상/미대상 파일 구분 필요
- 구현 날짜: 2025-11-06
- 구현자: Claude Code
