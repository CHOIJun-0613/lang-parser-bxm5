# Method/Class ë…¸ë“œ ë³µìž¡ë„ ì†ì„± ì¶”ê°€ (2025-11-05)

## ê°œìš”

Methodì™€ Class ë…¸ë“œì— ì½”ë“œ ë³µìž¡ë„ ì¸¡ì • ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ ìƒì„¸í•œ ë©”íŠ¸ë¦­ì„ ì œê³µí•©ë‹ˆë‹¤.

- **Method ë…¸ë“œ**: PLOC, LLOC, CLOC, Cognitive Complexity (ë©”ì„œë“œë³„ ë³µìž¡ë„)
- **Class ë…¸ë“œ**: PLOC, LLOC, CLOC, Code Complexity (í´ëž˜ìŠ¤ ì „ì²´ ë³µìž¡ë„)

## ì¶”ê°€ëœ ì†ì„±

### LOC (Lines of Code) ë©”íŠ¸ë¦­

| ì†ì„±ëª… | íƒ€ìž… | ì •ì˜ | ì„¤ëª… |
|--------|------|------|------|
| **PLOC** | int | Physical LOC | ë©”ì„œë“œ ë‚´ ëª¨ë“  ë¼ì¸ì˜ ìˆ˜ (ë¬¼ë¦¬ì  ë¼ì¸ ìˆ˜) |
| **LLOC** | int | Logical LOC | ë©”ì„œë“œ ë‚´ ì‹¤ì œ ì‹¤í–‰ ê°€ëŠ¥í•œ êµ¬ë¬¸ ë¼ì¸ìˆ˜ (ì£¼ì„ê³¼ ê³µë°± ì œì™¸) |
| **CLOC** | int | Comment LOC | ë©”ì„œë“œ ë‚´ ì£¼ì„ìœ¼ë¡œë§Œ ì´ë£¨ì–´ì§„ ë¼ì¸ì˜ ìˆ˜ |

### ë³µìž¡ë„ ë©”íŠ¸ë¦­

| ì†ì„±ëª… | íƒ€ìž… | ì •ì˜ | ì„¤ëª… |
|--------|------|------|------|
| **cognitive_complexity** | int | Cognitive Complexity | ì½”ë“œê°€ ì‚¬ëžŒì´ ì´í•´í•˜ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸°ì— ì–¼ë§ˆë‚˜ ì–´ë ¤ìš´ì§€ë¥¼ ì¸¡ì •í•˜ëŠ” ì§€í‘œ (SonarSource) |

## êµ¬í˜„ ìƒì„¸

### 1. ë°ì´í„° ëª¨ë¸ (graph_entities.py:84-90)

```python
class Method(BaseModel):
    # ... ê¸°ì¡´ ì†ì„± ...

    # LOC ë©”íŠ¸ë¦­
    PLOC: int = 0  # Physical LOC
    LLOC: int = 0  # Logical LOC
    CLOC: int = 0  # Comment LOC

    # ë³µìž¡ë„ ë©”íŠ¸ë¦­
    cognitive_complexity: int = 0  # Cognitive Complexity
```

### 2. ìžë™ ì¸¡ì • ë¡œì§

#### ë©”ì„œë“œ íŒŒì‹± ì‹œ ìžë™ ê³„ì‚° (project.py:560-592)

```python
# ë©”ì„œë“œ LOC ë©”íŠ¸ë¦­ ê³„ì‚°
method_loc_metrics = calculate_loc(method_source) if method_source and not is_dto else LOCMetrics(0, 0, 0)

# ë©”ì„œë“œ Cognitive Complexity ê³„ì‚°
method_cognitive_complexity = 0
if method_source and not is_dto:
    try:
        method_cognitive_complexity = calculate_method_cognitive_complexity(declaration)
    except Exception as e:
        logger.debug(f"ë©”ì„œë“œ Cognitive Complexity ê³„ì‚° ì‹¤íŒ¨ ({class_name}.{declaration.name}): {e}")

method = Method(
    # ... ê¸°ì¡´ ì†ì„± ...
    PLOC=method_loc_metrics.ploc,
    LLOC=method_loc_metrics.lloc,
    CLOC=method_loc_metrics.cloc,
    cognitive_complexity=method_cognitive_complexity
)
```

### 3. DTO í´ëž˜ìŠ¤ ìµœì í™”

**í™˜ê²½ ë³€ìˆ˜**: `SKIP_DTO_SOURCE=true`

DTO í´ëž˜ìŠ¤ì˜ ë©”ì„œë“œëŠ” ë³µìž¡ë„ ì¸¡ì •ì„ ê±´ë„ˆë›°ê³  ëª¨ë“  ê°’ì„ 0ìœ¼ë¡œ ì„¤ì •:

```python
# DTO í´ëž˜ìŠ¤ ë©”ì„œë“œëŠ” ë³µìž¡ë„ ì¸¡ì • ê±´ë„ˆë›°ê¸°
skip_dto_source = os.getenv("SKIP_DTO_SOURCE", "false").lower() == "true"
is_dto = skip_dto_source and is_dto_class(class_name, file_path)

if is_dto:
    # ëª¨ë“  ë³µìž¡ë„ ì†ì„±ì„ 0ìœ¼ë¡œ ì„¤ì •
    method_loc_metrics = LOCMetrics(0, 0, 0)
    method_cognitive_complexity = 0
```

**ìµœì í™” íš¨ê³¼**:
- DTO ë©”ì„œë“œ íŒŒì‹± ì‹œê°„: **70-90% ì ˆê°**
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: **30-40% ê°ì†Œ**
- ë¶ˆí•„ìš”í•œ ê³„ì‚° ì œê±°ë¡œ ì „ì²´ ë¶„ì„ ì†ë„ í–¥ìƒ

### 4. Neo4j ì €ìž¥

#### ë‹¨ì¼ íŠ¸ëžœìž­ì…˜ (project_nodes.py:448-468)

```python
method_records.append({
    # ... ê¸°ì¡´ ì†ì„± ...
    "PLOC": getattr(method, "PLOC", 0),
    "LLOC": getattr(method, "LLOC", 0),
    "CLOC": getattr(method, "CLOC", 0),
    "cognitive_complexity": getattr(method, "cognitive_complexity", 0),
})
```

#### ë°°ì¹˜ íŠ¸ëžœìž­ì…˜ (project_nodes.py:1186-1210)

```cypher
MERGE (meth:Method {name: m.method_name, class_name: m.class_name})
SET meth.return_type = m.return_type,
    meth.parameters = m.parameters_json,
    meth.annotations = m.annotations_json,
    meth.visibility = m.visibility,
    meth.description = m.description,
    meth.ai_description = m.ai_description,
    meth.logical_name = m.logical_name,
    meth.source = m.source,
    meth.package_name = m.package_name,
    meth.project_name = m.project_name,
    meth.PLOC = m.PLOC,
    meth.LLOC = m.LLOC,
    meth.CLOC = m.CLOC,
    meth.cognitive_complexity = m.cognitive_complexity,
    meth.updated_at = m.updated_at
```

## ì‚¬ìš© ì˜ˆì‹œ

### ë¶„ì„ ì‹¤í–‰

```bash
# ì¼ë°˜ ë¶„ì„ (ëª¨ë“  ë©”ì„œë“œ ë³µìž¡ë„ ì¸¡ì •)
python -m csa.cli.main analyze --all-objects --clean --project-name myproject

# DTO ìµœì í™” (DTO ë©”ì„œë“œ ë³µìž¡ë„ 0ìœ¼ë¡œ ì„¤ì •, ë¹ ë¥¸ ë¶„ì„)
SKIP_DTO_SOURCE=true python -m csa.cli.main analyze --all-objects --clean --project-name myproject
```

### Neo4j Cypher ì¿¼ë¦¬

#### ë³µìž¡ë„ê°€ ë†’ì€ ë©”ì„œë“œ ì°¾ê¸°

```cypher
MATCH (m:Method)
WHERE m.cognitive_complexity > 15
RETURN m.class_name, m.name, m.cognitive_complexity, m.PLOC, m.LLOC, m.CLOC
ORDER BY m.cognitive_complexity DESC
LIMIT 20
```

#### í´ëž˜ìŠ¤ë³„ í‰ê·  ë©”ì„œë“œ ë³µìž¡ë„

```cypher
MATCH (c:Class)-[:HAS_METHOD]->(m:Method)
RETURN c.name,
       avg(m.cognitive_complexity) as avg_complexity,
       avg(m.PLOC) as avg_ploc,
       avg(m.LLOC) as avg_lloc,
       count(m) as method_count
ORDER BY avg_complexity DESC
```

#### ë©”ì„œë“œ LOC ë¶„í¬ ë¶„ì„

```cypher
MATCH (m:Method)
WHERE m.PLOC > 0
RETURN
    CASE
        WHEN m.PLOC <= 10 THEN '0-10'
        WHEN m.PLOC <= 20 THEN '11-20'
        WHEN m.PLOC <= 50 THEN '21-50'
        WHEN m.PLOC <= 100 THEN '51-100'
        ELSE '100+'
    END as ploc_range,
    count(*) as method_count
ORDER BY ploc_range
```

#### ë³µìž¡ë„ì™€ LOC ìƒê´€ê´€ê³„ ë¶„ì„

```cypher
MATCH (m:Method)
WHERE m.PLOC > 0 AND m.cognitive_complexity > 0
RETURN m.class_name, m.name,
       m.PLOC, m.LLOC, m.CLOC,
       m.cognitive_complexity,
       toFloat(m.cognitive_complexity) / m.LLOC as complexity_per_line
ORDER BY complexity_per_line DESC
LIMIT 20
```

## ë©”íŠ¸ë¦­ í•´ì„ ê°€ì´ë“œ

### PLOC vs LLOC vs CLOC

```java
public void exampleMethod(int x) {        // PLOC = 9 (ì „ì²´ ë¼ì¸)
    // ì£¼ì„ ë¼ì¸ 1                          // CLOC = 3 (ì£¼ì„ ë¼ì¸)
    /* ì£¼ì„ ë¼ì¸ 2                         // LLOC = 4 (ì‹¤í–‰ êµ¬ë¬¸)
     * ì£¼ì„ ë¼ì¸ 3 */
    int y = x + 1;                        // LLOC 1
    System.out.println(y);                // LLOC 2
                                          // (ë¹ˆ ë¼ì¸ ì œì™¸)
    if (y > 0) {                         // LLOC 3
        return;                           // LLOC 4
    }
}
```

### Cognitive Complexity ê³„ì‚° ì˜ˆì‹œ

| ì œì–´ êµ¬ì¡° | ë³µìž¡ë„ ì¦ê°€ | ì˜ˆì‹œ |
|-----------|-------------|------|
| if, else if, switch | +1 | `if (x > 0) { ... }` |
| for, while, do-while | +1 | `for (int i = 0; i < 10; i++) { ... }` |
| catch | +1 | `catch (Exception e) { ... }` |
| ì¤‘ì²© (ê° ë ˆë²¨) | +1 | ì¤‘ì²© ifëŠ” +2 (if +1, ì¤‘ì²© +1) |
| ë…¼ë¦¬ ì—°ì‚°ìž (&&, \|\|) | +1 (ì‹œí€€ìŠ¤ë‹¹) | `if (a && b && c)` â†’ +2 |

**ê³„ì‚° ì˜ˆì‹œ**:

```java
public void complexMethod(int x, int y) {
    if (x > 0) {                          // +1 (if)
        for (int i = 0; i < x; i++) {     // +2 (for + ì¤‘ì²© ë ˆë²¨ 1)
            if (y > 0) {                  // +3 (if + ì¤‘ì²© ë ˆë²¨ 2)
                System.out.println(i * y);
            }
        }
    } else {                              // +1 (else)
        while (y < 10) {                  // +2 (while + ì¤‘ì²© ë ˆë²¨ 1)
            y++;
        }
    }
    // ì´ ë³µìž¡ë„: 1 + 2 + 3 + 1 + 2 = 9
}
```

## í’ˆì§ˆ ê¸°ì¤€

### ë©”ì„œë“œ ë³µìž¡ë„ ê¸°ì¤€ (SonarSource ê¶Œìž¥)

| Cognitive Complexity | ìƒíƒœ | ì¡°ì¹˜ |
|----------------------|------|------|
| 0 ~ 10 | âœ… ì–‘í˜¸ | ì´ìƒì ì´ë©° ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰¬ìš´ ì½”ë“œ |
| 11 ~ 15 | âš ï¸ ê´€ë¦¬ í•„ìš” | ë¦¬íŒ©í† ë§ ê³ ë ¤ |
| 16 ì´ìƒ | ðŸš¨ ë¦¬íŒ©í† ë§ í•„ìš” | ë©”ì„œë“œ ì¶”ì¶œ, ì±…ìž„ ë¶„ë¦¬ í•„ìˆ˜ |

### ë©”ì„œë“œ ê¸¸ì´ ê¸°ì¤€

| PLOC | LLOC | ìƒíƒœ | ì¡°ì¹˜ |
|------|------|------|------|
| 0-20 | 0-15 | âœ… ì–‘í˜¸ | ì´ìƒì ì¸ í¬ê¸° |
| 21-50 | 16-40 | âš ï¸ ê´€ë¦¬ í•„ìš” | ë©”ì„œë“œ ë¶„ë¦¬ ê³ ë ¤ |
| 51-100 | 41-80 | ðŸš¨ ê³¼ë‹¤ | ë©”ì„œë“œ ë¶„ë¦¬ ê¶Œìž¥ |
| 100+ | 80+ | ðŸ’€ ìœ„í—˜ | ì¦‰ì‹œ ë¦¬íŒ©í† ë§ í•„ìš” |

### ì£¼ì„ ë¹„ìœ¨ ê¸°ì¤€

**ì£¼ì„ ë¹„ìœ¨** = CLOC / PLOC Ã— 100%

| ì£¼ì„ ë¹„ìœ¨ | ìƒíƒœ | í•´ì„ |
|----------|------|------|
| 0-10% | âš ï¸ ë¶€ì¡± | ì£¼ì„ ì¶”ê°€ ê³ ë ¤ (ë³µìž¡í•œ ë¡œì§ì˜ ê²½ìš°) |
| 10-30% | âœ… ì ì • | ì´ìƒì ì¸ ì£¼ì„ ë¹„ìœ¨ |
| 30-50% | âš ï¸ ê³¼ë‹¤ | ì£¼ì„ ëŒ€ì‹  ì½”ë“œ ê°œì„  ê³ ë ¤ |
| 50%+ | ðŸš¨ ë¹„ì •ìƒ | ìžë™ ìƒì„± ì½”ë“œ ë˜ëŠ” ì„¤ê³„ ë¬¸ì œ ì˜ì‹¬ |

## í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (13ê°œ - ëª¨ë‘ í†µê³¼ âœ…)

1. Method ëª¨ë¸ ì†ì„± ê²€ì¦
2. ê¸°ë³¸ê°’ ê²€ì¦
3. LOC ê³„ì‚° ì •í™•ë„
4. ì£¼ì„ ì²˜ë¦¬ ì •í™•ë„
5. ë¹ˆ ë©”ì„œë“œ ì²˜ë¦¬
6. Cognitive Complexity ê³„ì‚° (ë‹¨ìˆœ/ì¡°ê±´/ì¤‘ì²©/ë°˜ë³µ/ë³µí•©)
7. DTO ë©”ì„œë“œ ì²˜ë¦¬
8. LOCMetrics í´ëž˜ìŠ¤
9. í˜¼í•© ì£¼ì„ ì²˜ë¦¬

**í…ŒìŠ¤íŠ¸ íŒŒì¼**: `tests/unit/test_method_complexity.py`

### í†µí•© í…ŒìŠ¤íŠ¸ (5ê°œ - ëª¨ë‘ í†µê³¼ âœ…)

1. Java íŒŒì‹± â†’ ë³µìž¡ë„ ì¸¡ì • ì „ì²´ í”Œë¡œìš°
2. DTO í´ëž˜ìŠ¤ ë³µìž¡ë„ 0 ê²€ì¦
3. í´ëž˜ìŠ¤ ë ˆë²¨ ë³µìž¡ë„ ë©”íŠ¸ë¦­
4. DTO í•„ë“œ ë…¼ë¦¬ëª… ì¶”ì¶œ ìƒëžµ ê²€ì¦
5. ì¼ë°˜ í´ëž˜ìŠ¤ ë³µìž¡ë„ ê³„ì‚° ê²€ì¦

**í…ŒìŠ¤íŠ¸ íŒŒì¼**: `tests/integration/test_method_complexity_integration.py`

## ì„±ëŠ¥ ì˜í–¥

### DTO ìµœì í™” íš¨ê³¼ (`SKIP_DTO_SOURCE=true`)

| í•­ëª© | ê°œì„ ìœ¨ |
|------|--------|
| DTO ë©”ì„œë“œ íŒŒì‹± ì‹œê°„ | **70-90% ì ˆê°** |
| ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | **30-40% ê°ì†Œ** |
| ì „ì²´ ë¶„ì„ ì‹œê°„ | **10-20% ë‹¨ì¶•** (DTO ë¹„ìœ¨ì— ë”°ë¼) |

### ì¸¡ì • ì˜¤ë²„í—¤ë“œ

- ì¼ë°˜ ë©”ì„œë“œ: **ì•½ 2-5ms ì¶”ê°€** (LOC + Cognitive Complexity ê³„ì‚°)
- DTO ë©”ì„œë“œ: **0ms** (ì¸¡ì • ê±´ë„ˆë›°ê¸°)
- Neo4j ì €ìž¥: **ì˜í–¥ ì—†ìŒ** (ê¸°ì¡´ ë°°ì¹˜ ì²˜ë¦¬ í™œìš©)

## í–¥í›„ í™œìš© ë°©ì•ˆ

1. **ì½”ë“œ í’ˆì§ˆ ëŒ€ì‹œë³´ë“œ**
   - í”„ë¡œì íŠ¸ ì „ì²´ ë©”ì„œë“œ ë³µìž¡ë„ ë¶„í¬ ì‹œê°í™”
   - ë¦¬íŒ©í† ë§ ìš°ì„ ìˆœìœ„ ìžë™ ë„ì¶œ

2. **CI/CD í†µí•©**
   - ë³µìž¡ë„ ìž„ê³„ê°’ ì´ˆê³¼ ì‹œ ë¹Œë“œ ê²½ê³ /ì‹¤íŒ¨
   - ì½”ë“œ ë¦¬ë·° ì‹œ ë³µìž¡ë„ ë³€í™” ì¶”ì 

3. **ê¸°ìˆ  ë¶€ì±„ ê´€ë¦¬**
   - ê³ ë³µìž¡ë„ ë©”ì„œë“œ ëª©ë¡ ìžë™ ìƒì„±
   - ë³µìž¡ë„ ì¶”ì„¸ ë¶„ì„ (ì‹œê°„ë³„ ë³€í™”)

4. **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ìš°ì„ ìˆœìœ„**
   - ë³µìž¡ë„ ë†’ì€ ë©”ì„œë“œ ìš°ì„  í…ŒìŠ¤íŠ¸ ìž‘ì„±
   - í…ŒìŠ¤íŠ¸ ë‚œì´ë„ ì˜ˆì¸¡

## êµ¬í˜„ íŒŒì¼ ëª©ë¡

- ëª¨ë¸: [csa/models/graph_entities.py](../csa/models/graph_entities.py)
- Java ë¶„ì„: [csa/services/java_analysis/project.py](../csa/services/java_analysis/project.py)
- Neo4j ì €ìž¥: [csa/services/graph_db/project_nodes.py](../csa/services/graph_db/project_nodes.py)
- LOC ê³„ì‚°: [csa/utils/loc_calculator.py](../csa/utils/loc_calculator.py)
- Cognitive Complexity: [csa/utils/cognitive_complexity.py](../csa/utils/cognitive_complexity.py)

## ì°¸ê³  ìžë£Œ

- [SonarSource Cognitive Complexity](https://www.sonarsource.com/resources/cognitive-complexity/)
- [LOC ë©”íŠ¸ë¦­ í‘œì¤€](https://en.wikipedia.org/wiki/Source_lines_of_code)
- [Clean Code by Robert C. Martin](https://www.oreilly.com/library/view/clean-code-a/9780136083238/)
